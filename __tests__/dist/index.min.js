/*!
 * name: @jswork/app-cache
 * description: An app scripts cache solution based on localStorage.
 * homepage: https://github.com/afeiship/app-cache
 * version: 1.0.2
 * date: 2020-12-19 16:41:46
 * license: MIT
 */
!function(){var n={success:function(){}};function r(){this._manifest=this.getManifest(),this._response=[],this._manifest||(this.initManifest(),this._manifest=this.getManifest())}r.VERSION="__VERSION__",r.PREFIX="__app_cache__",r.NOOP=function(){},r._instance=null,r.load=function(t,e){return r._instance||(r._instance=new r),r._instance.load(t,e),r._instance},r.diff=function(t,e){return t.filter(function(t){return-1===e.indexOf(t)})},r.prototype={constructor:r,loadQueue:function(s){var i=this,o=this._loadOptions.success||r.NOOP,t=this._loadOptions.error||r.NOOP,a=this._loadFiles[s],c=this._loadFiles.length;i.loadText(a,{success:function(t){var e=t.content,n=-1<t.type.indexOf("javascript")?"injectScript":"injectStyle";i._response.push(t),i[n](e),i._manifest.files[a]=!0,i.setManifest(i._manifest),i.setStore(a,e),i._response.length===c?o(i._response):i.loadQueue(s+1)},error:t})},load:function(t,e){this._loadFiles=t,this._loadOptions=e||n,this.syncManifest(t),this.loadQueue(0)}},window.AppCache=r}(),AppCache.prototype.loadFromXHR=function(t,e,n,s){var i=new XMLHttpRequest;i.open("GET",t),i.onreadystatechange=function(){4===i.readyState&&(200===i.status||0===i.status&&i.responseText?e({content:i.responseText,type:i.getResponseHeader("content-type")}):n(i.statusText))},setTimeout(function(){i.readyState<4&&(i.abort(),n(i.statusText))},s),i.send()},AppCache.prototype.loadFromCache=function(t,e,n,s){try{var i=t.indexOf("?"),i=-1===i?t:t.slice(0,i);e({content:this.getStore(t),type:"js"===i.slice(-2)?"application/javascript":"text/css"})}catch(t){n(t)}},function(i){i.prototype.hasLoad=function(t){return this.getManifest().files[t]},i.prototype.loadText=function(t,e){var n=e.timeout||3e4,s=e.success||i.NOOP,e=e.error||i.NOOP;this.hasLoad(t)?this.loadFromCache(t,s,e,n):this.loadFromXHR(t,s,e,n)}}(AppCache),function(t){var n=document.head||document.getElementsByTagName("head")[0];t.injectScript=t.prototype.injectScript=function(t){var e=document.createElement("script");e.defer=!0,e.text=t,n.appendChild(e)}}(AppCache),function(t){var n=document.head||document.getElementsByTagName("head")[0];t.injectStyle=t.prototype.injectStyle=function(t){var e=document.createElement("style");e.type="text/css",e.styleSheet?e.styleSheet.cssText=t:e.appendChild(document.createTextNode(t)),n.appendChild(e)}}(AppCache),function(n){var t=n.prototype,s=window.localStorage;t.setStore=function(t,e){t=n.PREFIX+t,e="string"==typeof e?e:JSON.stringify(e);s.setItem(t,e)},t.getStore=function(t,e){t=n.PREFIX+t,t=s.getItem(t);return"json"===e?JSON.parse(t):t},t.removeStore=function(t){t=n.PREFIX+t;s.removeItem(t)},t.clearStore=function(){var t=Object.keys(s),e=n.PREFIX;t.forEach(function(t){0===t.indexOf(e)&&s.removeItem(t)})}}(AppCache),function(r){var t=r.prototype,e="manifest";t.initManifest=function(){this.setStore(e,{prefix:r.PREFIX,files:{}})},t.syncManifest=function(t){for(var e,n=this._manifest.files,s=Object.keys(n),i=r.diff(t,s),o=r.diff(s,t),a=0,c=i.length;a<c;a++)n[e=i[a]]=!1;for(a=0,c=o.length;a<c;a++)delete n[e=o[a]],this.removeStore(e);this._manifest.files=n},t.hasManifest=function(){return!!this.getStore(e)},t.getManifest=function(){return this.getStore(e,"json")},t.setManifest=function(t){this.setStore(e,t)}}(AppCache);